<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chloe's Closet - Dress Up Game</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      background-color: #ffeef2;
      font-family: 'Press Start 2P', cursive;
      margin-top: 40px;
      display: flex;
      justify-content: center;
      image-rendering: pixelated;
    }

    .main-layout {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      flex-wrap: wrap;
    }

    .character-preview {
      width: 300px;
      background-color: #fff0f6;
      border: 4px solid #ff66cc;
      box-shadow: 8px 8px 0 #ff99cc;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }

    .character-box {
      position: relative;
      width: 200px;
      height: 300px;
    }

    .character-box img {
      position: absolute;
      width: 200px;
      top: 0;
      left: 0;
      image-rendering: pixelated;
    }

    .browser-frame {
      width: 600px;
      background-color: #fffafc;
      border: 4px solid #ffaacc;
      box-shadow: 8px 8px 0 #ff99cc;
    }

    .browser-topbar {
      background-color: #ffd6ea;
      padding: 8px;
      display: flex;
      align-items: center;
    }

    .dot {
      height: 12px;
      width: 12px;
      margin-right: 5px;
    }

    .red { background-color: #ff6b6b; }
    .yellow { background-color: #fcd34d; }
    .green { background-color: #6ee7b7; }

    .browser-title {
      margin-left: 10px;
      color: #a33366;
      font-size: 10px;
    }

    .tab-bar {
      background-color: #ffe0f0;
      padding: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      border-bottom: 2px solid #ff99cc;
    }

    .tab {
      background-color: #ffe0f0;
      border: 2px solid #ff99cc;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 10px;
      color: #a33366;
      box-shadow: 2px 2px 0 #ff99cc;
      transition: all 0.2s ease-in-out;
    }

    .tab:hover {
      background-color: #fff0f8;
      transform: scale(1.05);
    }

    .tab.active {
      background-color: #fff0f6;
      font-weight: bold;
    }

    .tab-content {
      display: none;
      padding: 20px;
      font-size: 10px;
      color: #444;
    }

    .tab-content.open {
      display: block;
      animation: fadeDown 0.4s ease-out;
    }

    @keyframes fadeDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .option-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .option-button {
      background-color: #ffe0f0;
      border: 2px solid #ff99cc;
      padding: 8px;
      cursor: pointer;
      font-size: 9px;
      color: #a33366;
      box-shadow: 2px 2px 0 #ff99cc;
      transition: transform 0.2s ease-in-out;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .option-button:hover {
      background-color: #fff0f8;
      transform: scale(1.1);
    }

    .option-button img {
      image-rendering: pixelated;
      width: 32px;
      height: 32px;
      object-fit: contain;
      margin-bottom: 4px;
    }

    .control-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 10px;
      width: 100%;
      justify-content: center;
    }

    .control-buttons button {
      font-size: 10px;
      padding: 6px 12px;
      background-color: #ffd6ea;
      border: 2px solid #ff99cc;
      cursor: pointer;
      font-family: 'Press Start 2P';
      color: #a33366;
      transition: all 0.2s ease-in-out;
    }

    .control-buttons button:hover {
      background-color: #fff0f8;
      transform: scale(1.05);
    }

    .undo-redo {
      display: flex;
      gap: 5px;
      width: 100%;
      justify-content: center;
    }

    .undo-redo button {
      flex: 1;
    }

    .sticker {
      position: absolute;
      font-size: 24px;
      cursor: move;
      user-select: none;
      z-index: 10;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 700px) {
      .main-layout {
        flex-direction: column;
        align-items: center;
      }

      .browser-frame, .character-preview {
        width: 90%;
      }
    }
  </style>
</head>
<body>
  <div class="main-layout">
    <div class="character-preview">
      <h2 style="color: #a33366; font-size: 10px; margin-bottom: 10px;">Character Preview</h2>
      <div class="character-box" id="capture-area">
        <!-- Character layers in proper stacking order -->
        <img id="body_back" src="" alt="Body Back" />
        <img id="hair_back" src="" alt="Hair Back" />
        <img id="accessory_back" src="" alt="Accessory Back" />
        <img id="accessory_middle_back" src="" alt="Accessory Middle Back" />
        <img id="body_front" src="" alt="Body Front" />
        <img id="body_front_color" src="" alt="Body Front Color" />
        <img id="head" src="" alt="Head" />
        <img id="face_back" src="" alt="Face Back" />
        <img id="eye" src="" alt="Eyes" />
        <img id="eye_color" src="" alt="Eye Color" />
        <img id="face_front" src="" alt="Face Front" />
        <img id="hair_front" src="" alt="Hair Front" />
        <img id="hair_back_accessory" src="" alt="Hair Back Accessory" />
        <img id="accessory_middle_front" src="" alt="Accessory Middle Front" />
        <img id="accessory_front" src="" alt="Accessory Front" />
        
        <!-- Stickers container -->
        <div id="stickers-container"></div>
      </div>
      
      <div class="control-buttons">
        <button onclick="randomizeCharacter()">üé≤ Randomize</button>
        <button onclick="resetCharacter()">üßº Reset</button>
        <button onclick="saveImage()">üì∏ Save Look</button>
      </div>
      
      <div class="undo-redo">
        <button onclick="undo()" id="undoBtn">‚Ü∂ Undo</button>
        <button onclick="redo()" id="redoBtn">‚Ü∑ Redo</button>
      </div>
    </div>

    <div class="browser-frame">
      <div class="browser-topbar">
        <span class="dot red"></span>
        <span class="dot yellow"></span>
        <span class="dot green"></span>
        <span class="browser-title">Chloe's Closet</span>
      </div>

      <div class="tab-bar">
        <button class="tab active" onclick="showTab('body')">Body</button>
        <button class="tab" onclick="showTab('hair')">Hair</button>
        <button class="tab" onclick="showTab('face')">Face</button>
        <button class="tab" onclick="showTab('eyes')">Eyes</button>
        <button class="tab" onclick="showTab('accessories')">Accessories</button>
        <button class="tab" onclick="showTab('stickers')">Stickers</button>
        <button class="tab" onclick="showTab('bundles')">Bundles</button>
      </div>

      <div id="tab-content-container">
        <!-- Tab content will be dynamically generated here -->
      </div>
    </div>
  </div>

  <script>
    // Asset configuration based on your uploaded files
    const assetConfig = {
      body_back: [
        '¬¢‚ñê√Ö√π√¶√≤√¶‚åê1', '¬¢‚ñê√Ö√π√¶√≤√¶‚åê2', '√Ñ√§√≤‚Çß(√¢V√¢√¢√¢c)1', '√Ñ√§√≤‚Çß(√¢V√¢√¢√¢c)2',
        '√Ñ√§√≤‚Çß(√¢Z√º[√¢^√º[)1', '√Ñ√§√≤‚Çß(√¢Z√º[√¢^√º[)2', '√Ñ√§√≤‚Çß(√¢u√¢√´√¢E√¢X)1', '√Ñ√§√≤‚Çß(√¢u√¢√´√¢E√¢X)2',
        '√¢G√¢v√¢√¨√¢√¥√¢h√¢√Æ√¢X1', '√¢G√¢v√¢√¨√¢√¥√¢h√¢√Æ√¢X2', '√¢R√¢√Ø√¢Z√¢b√¢g1', '√¢R√¢√Ø√¢Z√¢b√¢g2',
        '√¢S√¢X√¢√¨√¢√®(√¢~√¢j)1', '√¢S√¢X√¢√¨√¢√®(√¢~√¢j)2', '√¢T√¢}√º[√¢h√¢√Æ√¢X1', '√¢T√¢}√º[√¢h√¢√Æ√¢X2',
        '√¢X√¢N√º[√¢√Ø√â√†√Ü√†(√∂√Ü)1', '√¢X√¢N√º[√¢√Ø√â√†√Ü√†(√∂√Ü)2', '√¢X√¢N√º[√¢√Ø√â√†√Ü√†1', '√¢X√¢N√º[√¢√Ø√â√†√Ü√†2',
        '√¢Z√º[√¢√´√º[√≤‚Çß1', '√¢Z√º[√¢√´√º[√≤‚Çß2', '√¢u√¢√Æ√¢U√º[1', '√¢u√¢√Æ√¢U√º[2',
        '√¶f√¶‚ï†1', '√¶f√¶‚ï†2', '√¶‚ï†√¶√á√Ü√†1', '√¶‚ï†√¶√á√Ü√†2'
      ],
      body_front: [
        '¬¢‚ñê√Ö√π√¶√≤√¶‚åê1', '¬¢‚ñê√Ö√π√¶√≤√¶‚åê2', '√Ñ√§√≤‚Çß(√¢V√¢√¢√¢c)1', '√Ñ√§√≤‚Çß(√¢V√¢√¢√¢c)2',
        '√Ñ√§√≤‚Çß(√¢Z√º[√¢^√º[)1', '√Ñ√§√≤‚Çß(√¢Z√º[√¢^√º[)2', '√Ñ√§√≤‚Çß(√¢u√¢√´√¢E√¢X)1', '√Ñ√§√≤‚Çß(√¢u√¢√´√¢E√¢X)2',
        '√¢G√¢v√¢√¨√¢√¥√¢h√¢√Æ√¢X1', '√¢G√¢v√¢√¨√¢√¥√¢h√¢√Æ√¢X2', '√¢R√¢√Ø√¢Z√¢b√¢g1', '√¢R√¢√Ø√¢Z√¢b√¢g2',
        '√¢S√¢X√¢√¨√¢√®(√¢~√¢j)1', '√¢S√¢X√¢√¨√¢√®(√¢~√¢j)2', '√¢Z√º[√¢√´√º[√≤‚Çß1', '√¢Z√º[√¢√´√º[√≤‚Çß2',
        '√¢u√¢√Æ√¢U√º[1', '√¢u√¢√Æ√¢U√º[2', '√¶‚ï†√¶√á√Ü√†1', '√¶‚ï†√¶√á√Ü√†2'
      ],
      hair_back: [
        '√ÑO√©‚î¨√≤‚ï•√©‚ñå', '√¢E√¢F√º[√¢u√¢Z√¢~√¢√¨√¢√¥√¢O', '√¢E√¢F√º[√¢u√¢√¨√¢√¥√¢O', '√¢M√¢U√¢M√¢U√¢V√¢√ß√º[√¢g',
        '√¢M√¢U√¢M√¢U√¢Z√¢~√¢√¨√¢√¥√¢O', '√¢M√¢U√¢M√¢U√¢√¨√¢√¥√¢O', '√¢T√¢C√¢h√¢e√º[√¢√Ø√¨‚ï¢(√ÜZ)', '√¢V√¢√ß√º[√¢g',
        '√¢Z√¢~√¢√¨√¢√¥√¢O', '√¢c√¢C√¢√¥√¢e√º[√¢√Ø(√ÜZ)', '√¢c√¢C√¢√¥√¢e√º[√¢√Ø(√Ü‚ïñ)', '√¢c√¢C√¢√¥√¢h√¢√®√¢√Ø',
        '√¢{√¢u√¢J√¢b√¢g', '√¢√¨√¢√¥√¢O', '√¥¬±√©‚î¨√Æ√Ø√©‚ï§'
      ],
      hair_front: [
        '√Ü√•√≤¬¨√©¬ª1', '√Ü√•√≤¬¨√©¬ª2', '√¢C√¢√¥√¢e√º[√¢N', '√¢E√¢F√º[√¢u', '√¢i√¢`√¢√†√¢√´√¢√Ø',
        '√¢√Ö√¢C√¢√Ø√¢h', '√©¬°√©‚ï£√ª‚ï§', '√©¬ø√Ö‚àû√πl', '√©‚ïß√©‚î¥√©‚î¨√©¬±', '√´√≠√≤¬¨√©¬ª'
      ],
      hair_back_accessory: [
        '√ÑO√©‚î¨√≤‚ï•√©‚ñå', '√¢T√¢C√¢h√¢e√º[√¢√Ø√¨‚ï¢(√ÜZ)', '√¢c√¢C√¢√¥√¢e√º[√¢√Ø(√ÜZ)', '√¢c√¢C√¢√¥√¢e√º[√¢√Ø(√Ü‚ïñ)', '√¢c√¢C√¢√¥√¢h√¢√®√¢√Ø'
      ],
      head: [
        '√â‚î¨√©‚î§√©‚ñÄ√©‚ïú√®œÑ1', '√â‚î¨√©‚î§√©‚ñÄ√©‚ïú√®œÑ2', '√≤√º√Ü‚ï©√©‚ïö√®œÑ1', '√≤√º√Ü‚ï©√©‚ïö√®œÑ2'
      ],
      face_back: [
        '√ÑO√®p√Æ‚àö(√¶f)', '√ÑO√®p√Æ‚àö(√¨√≥√©Œ¶)', '√ÑO√®p√Æ‚àö(√¥{√©Œ¶)', '√Ö‚ïû√©Œ©(√Æ‚àö√®J√©¬Ω)', '√Ö‚ïû√©Œ©(√Æ‚àö√≤‚î¨√©‚ï¢)',
        '√Ö‚ï¨√©√≥(√Æ‚àö√®J√©¬Ω)', '√Ö‚ï¨√©√≥(√Æ‚àö√≤‚î¨√©‚ï¢)', '√¶f', '√¨√≥√©Œ¶(√Æ‚àö√®J√©¬Ω)', '√¨√≥√©Œ¶(√Æ‚àö√≤‚î¨√©‚ï¢)',
        '√Ø‚î¥√©¬Ω', '√¥{√©Œ¶(√Æ‚àö√®J√©¬Ω)', '√¥{√©Œ¶(√Æ‚àö√≤‚î¨√©‚ï¢)', '√∂L√Æ‚àö(√Æ‚àö√®J√©¬Ω)', '√∂L√Æ‚àö(√Æ‚àö√≤‚î¨√©‚ï¢)'
      ],
      face_front: [
        '√ÑO√®p√Æ‚àö(√¶f)', '√ÑO√®p√Æ‚àö(√¨√≥√©Œ¶)', '√ÑO√®p√Æ‚àö(√¥{√©Œ¶)', '√Ö‚ïû√©Œ©(√Æ‚àö√®J√©¬Ω)', '√Ö‚ïû√©Œ©(√Æ‚àö√≤‚î¨√©‚ï¢)',
        '√Ö‚ï¨√©√≥(√Æ‚àö√®J√©¬Ω)', '√Ö‚ï¨√©√≥(√Æ‚àö√≤‚î¨√©‚ï¢)', '√¶f', '√¨√≥√©Œ¶(√Æ‚àö√®J√©¬Ω)', '√¨√≥√©Œ¶(√Æ‚àö√≤‚î¨√©‚ï¢)',
        '√Ø‚î¥√©¬Ω', '√¥{√©Œ¶(√Æ‚àö√®J√©¬Ω)', '√¥{√©Œ¶(√Æ‚àö√≤‚î¨√©‚ï¢)', '√∂L√Æ‚àö(√Æ‚àö√®J√©¬Ω)', '√∂L√Æ‚àö(√Æ‚àö√≤‚î¨√©‚ï¢)'
      ],
      eye: [
        '√ÑO√®p√ª‚îå(√¨√≤√©‚ñÄ)1', '√ÑO√®p√ª‚îå(√¨√≤√©‚ñÄ)2', '√ÑO√®p√ª‚îå(√¨√≤√©‚ñÄ)3', '√ÑO√®p√ª‚îå1', '√ÑO√®p√ª‚îå2', '√ÑO√®p√ª‚îå3',
        '√Ü‚ñê√©Œ¶√ª‚îå(√¨√≤√©‚ñÄ)1', '√Ü‚ñê√©Œ¶√ª‚îå(√¨√≤√©‚ñÄ)2', '√Ü‚ñê√©Œ¶√ª‚îå(√¨√≤√©‚ñÄ)3', '√Ü‚ñê√©Œ¶√ª‚îå1', '√Ü‚ñê√©Œ¶√ª‚îå2', '√Ü‚ñê√©Œ¶√ª‚îå3',
        '√â√©√©Œ©√ª‚îå(√¨√≤√©‚ñÄ)1', '√â√©√©Œ©√ª‚îå(√¨√≤√©‚ñÄ)2', '√â√©√©Œ©√ª‚îå(√¨√≤√©‚ñÄ)3', '√â√©√©Œ©√ª‚îå1', '√â√©√©Œ©√ª‚îå2', '√â√©√©Œ©√ª‚îå3',
        '√¢f√¢t√¢H√¢√Ø√¢√º√ª‚îå1', '√¢f√¢t√¢H√¢√Ø√¢√º√ª‚îå2', '√¢√Ö√¢√Ø√ª‚îå(√¨√≤√©‚ñÄ)1', '√¢√Ö√¢√Ø√ª‚îå(√¨√≤√©‚ñÄ)2', '√¢√Ö√¢√Ø√ª‚îå(√¨√≤√©‚ñÄ)3',
        '√¢√Ö√¢√Ø√ª‚îå1', '√¢√Ö√¢√Ø√ª‚îå2', '√¢√Ö√¢√Ø√ª‚îå3', '√®‚ñà√Ü‚ñê√©Œ¶√ª‚îå(√¨√≤√©‚ñÄ)1', '√®‚ñà√Ü‚ñê√©Œ¶√ª‚îå(√¨√≤√©‚ñÄ)2', '√®‚ñà√Ü‚ñê√©Œ¶√ª‚îå(√¨√≤√©‚ñÄ)3',
        '√®‚ñà√Ü‚ñê√©Œ¶√ª‚îå1', '√®‚ñà√Ü‚ñê√©Œ¶√ª‚îå2', '√®‚ñà√Ü‚ñê√©Œ¶√ª‚îå3', '√©‚ïõ√©Œò√ª‚îå(√¨√≤√©‚ñÄ)1', '√©‚ïõ√©Œò√ª‚îå(√¨√≤√©‚ñÄ)2', '√©‚ïõ√©Œò√ª‚îå(√¨√≤√©‚ñÄ)3',
        '√©‚ïõ√©Œò√ª‚îå1', '√©‚ïõ√©Œò√ª‚îå2', '√©‚ïõ√©Œò√ª‚îå3', '√≤√º√Ü‚ï©√©‚ïö√ª‚îå(√¨√≤√©‚ñÄ)1', '√≤√º√Ü‚ï©√©‚ïö√ª‚îå(√¨√≤√©‚ñÄ)2', '√≤√º√Ü‚ï©√©‚ïö√ª‚îå(√¨√≤√©‚ñÄ)3',
        '√≤√º√Ü‚ï©√©‚ïö√ª‚îå1', '√≤√º√Ü‚ï©√©‚ïö√ª‚îå2', '√≤√º√Ü‚ï©√©‚ïö√ª‚îå3', '√≤‚î¨√©‚ï¢√ª‚îå1', '√≤‚î¨√©‚ï¢√ª‚îå2', '√≤‚î¨√©‚ï¢√ª‚îå3', '√ª_√ª‚îå'
      ],
      eye_color: [
        '√ÑO√®p√ª‚îå(√¨√≤√©‚ñÄ)1', '√ÑO√®p√ª‚îå(√¨√≤√©‚ñÄ)2', '√ÑO√®p√ª‚îå(√¨√≤√©‚ñÄ)3', '√ÑO√®p√ª‚îå1', '√ÑO√®p√ª‚îå2', '√ÑO√®p√ª‚îå3',
        '√Ü‚ñê√©Œ¶√ª‚îå(√¨√≤√©‚ñÄ)1', '√Ü‚ñê√©Œ¶√ª‚îå(√¨√≤√©‚ñÄ)2', '√Ü‚ñê√©Œ¶√ª‚îå(√¨√≤√©‚ñÄ)3', '√Ü‚ñê√©Œ¶√ª‚îå1', '√Ü‚ñê√©Œ¶√ª‚îå2', '√Ü‚ñê√©Œ¶√ª‚îå3',
        '√â√©√©Œ©√ª‚îå(√¨√≤√©‚ñÄ)1', '√â√©√©Œ©√ª‚îå(√¨√≤√©‚ñÄ)2', '√â√©√©Œ©√ª‚îå(√¨√≤√©‚ñÄ)3', '√â√©√©Œ©√ª‚îå1', '√â√©√©Œ©√ª‚îå2', '√â√©√©Œ©√ª‚îå3',
        '√¢√Ö√¢√Ø√ª‚îå(√¨√≤√©‚ñÄ)1', '√¢√Ö√¢√Ø√ª‚îå(√¨√≤√©‚ñÄ)2', '√¢√Ö√¢√Ø√ª‚îå(√¨√≤√©‚ñÄ)3', '√¢√Ö√¢√Ø√ª‚îå1', '√¢√Ö√¢√Ø√ª‚îå2', '√¢√Ö√¢√Ø√ª‚îå3',
        '√®‚ñà√Ü‚ñê√©Œ¶√ª‚îå(√¨√≤√©‚ñÄ)1', '√®‚ñà√Ü‚ñê√©Œ¶√ª‚îå(√¨√≤√©‚ñÄ)2', '√®‚ñà√Ü‚ñê√©Œ¶√ª‚îå(√¨√≤√©‚ñÄ)3', '√®‚ñà√Ü‚ñê√©Œ¶√ª‚îå1', '√®‚ñà√Ü‚ñê√©Œ¶√ª‚îå2', '√®‚ñà√Ü‚ñê√©Œ¶√ª‚îå3',
        '√©‚ïõ√©Œò√ª‚îå(√¨√≤√©‚ñÄ)1', '√©‚ïõ√©Œò√ª‚îå(√¨√≤√©‚ñÄ)2', '√©‚ïõ√©Œò√ª‚îå(√¨√≤√©‚ñÄ)3', '√©‚ïõ√©Œò√ª‚îå1', '√©‚ïõ√©Œò√ª‚îå2', '√©‚ïõ√©Œò√ª‚îå3',
        '√≤√º√Ü‚ï©√©‚ïö√ª‚îå(√¨√≤√©‚ñÄ)1', '√≤√º√Ü‚ï©√©‚ïö√ª‚îå(√¨√≤√©‚ñÄ)2', '√≤√º√Ü‚ï©√©‚ïö√ª‚îå(√¨√≤√©‚ñÄ)3', '√≤√º√Ü‚ï©√©‚ïö√ª‚îå1', '√≤√º√Ü‚ï©√©‚ïö√ª‚îå2', '√≤√º√Ü‚ï©√©‚ïö√ª‚îå3'
      ],
      accessory_back: [
        '√âG√®o(√∂¬ª)', '√¢A√¢z√ª‚ï§√¶‚ïõ√©‚ñÄ(√∂¬ª)', '√¢A√¢z√ª‚ï§√¨‚ï´√©‚ñÄ(√∂¬ª)', '√¢G√¢√Ø√¢t√Ñ¬ø(√∂¬∫)', '√¢w√¢A√¢o√¢√¥√¢g√¢√®√¢{√¢√¥',
        '√¢w√¢b√¢h√¢h√¢√Æ√¢X√¢√®√¢{√¢√¥(√≤‚Çß)', '√¢z√¢√Ö√¢C√¢g√¢u√¢√®√¢√á', '√¢√º√¢K√¢l(√¨√≤√´√Ö)', '√¢√º√¢K√¢l',
        '√©Œ±√©‚ñå√©√°√©‚ñë√ÜZ√©‚ñÄ(√∂¬ª)', '√©Œ±√©‚ñå√©√°√©‚ñë√©‚îê√©œÉ√©√≥√Ü‚ïñ(√∂¬ª)', '√©Œ±√©‚ñå√©√°√©‚ñë√≤¬•√¨L(√∂¬ª)', '√©Œ±√©‚ñå√©√°√©‚ñë√≤‚ï•√©‚ñå(√∂¬ª)',
        '√™¬Ω√ª√©√©‚ï†√®p', '√™¬Ω√ª√©√©‚ï†√´H', '√¥V√Ñg√©‚ï†√´H', '√¥V√Ñg√©‚ï†√π‚ïì', '√∂L√Ñ¬ø(√∂¬ª)'
      ],
      accessory_front: [
        '√âG√®o(√∂¬ª)', '√¢A√¢z√ª‚ï§√¶‚ïõ√©‚ñÄ(√∂¬ª)', '√¢A√¢z√ª‚ï§√¨‚ï´√©‚ñÄ(√∂¬ª)', '√¢w√¢A√¢o√¢√¥√¢g√¢√®√¢{√¢√¥',
        '√¢w√¢b√¢h√¢h√¢√Æ√¢X√¢√®√¢{√¢√¥(√≤‚Çß)', '√¢z√¢√Ö√¢C√¢g√¢u√¢√®√¢√á', '√¢√º√¢K√¢l(√¨√≤√´√Ö)', '√¢√º√¢K√¢l', '√¥V√Ñg√©‚ï†√π‚ïì'
      ],
      accessory_middle_back: [
        '√¢G√¢√Ø√¢t√Ñ¬ø(√∂¬∫)', '√©Œ±√©‚ñå√©√°√©‚ñë√ÜZ√©‚ñÄ(√∂¬ª)', '√©Œ±√©‚ñå√©√°√©‚ñë√©‚îê√©œÉ√©√≥√Ü‚ïñ(√∂¬ª)', '√©Œ±√©‚ñå√©√°√©‚ñë√≤¬•√¨L(√∂¬ª)',
        '√©Œ±√©‚ñå√©√°√©‚ñë√≤‚ï•√©‚ñå(√∂¬ª)', '√™¬Ω√ª√©√©‚ï†√®p', '√∂L√Ñ¬ø(√∂¬ª)'
      ],
      accessory_middle_front: [
        '√¢G√¢√Ø√¢t√Ñ¬ø(√∂¬∫)', '√©Œ±√©‚ñå√©√°√©‚ñë√ÜZ√©‚ñÄ(√∂¬ª)', '√©Œ±√©‚ñå√©√°√©‚ñë√©‚îê√©œÉ√©√≥√Ü‚ïñ(√∂¬ª)', '√©Œ±√©‚ñå√©√°√©‚ñë√≤¬•√¨L(√∂¬ª)',
        '√©Œ±√©‚ñå√©√°√©‚ñë√≤‚ï•√©‚ñå(√∂¬ª)', '√™¬Ω√ª√©√©‚ï†√®p'
      ]
    };

    const bundles = {
      cute: {
        body_back: '√Ñ√§√≤‚Çß(√¢V√¢√¢√¢c)1',
        body_front: '√Ñ√§√≤‚Çß(√¢V√¢√¢√¢c)1',
        hair_back: '√¢c√¢C√¢√¥√¢e√º[√¢√Ø(√Ü‚ïñ)',
        hair_front: '√¢E√¢F√º[√¢u',
        hair_back_accessory: '√¢c√¢C√¢√¥√¢e√º[√¢√Ø(√Ü‚ïñ)',
        head: '√â‚î¨√©‚î§√©‚ñÄ√©‚ïú√®œÑ1',
        face_back: '√ÑO√®p√Æ‚àö(√¶f)',
        face_front: '√ÑO√®p√Æ‚àö(√¶f)',
        eye: '√ÑO√®p√ª‚îå1',
        eye_color: '√ÑO√®p√ª‚îå1',
        accessory_back: '√¢√º√¢K√¢l',
        accessory_front: '√¢√º√¢K√¢l',
        accessory_middle_back: '√¢G√¢√Ø√¢t√Ñ¬ø(√∂¬∫)',
        accessory_middle_front: '√¢G√¢√Ø√¢t√Ñ¬ø(√∂¬∫)'
      },
      elegant: {
        body_back: '√¢G√¢v√¢√¨√¢√¥√¢h√¢√Æ√¢X1',
        body_front: '√¢G√¢v√¢√¨√¢√¥√¢h√¢√Æ√¢X1',
        hair_back: '√¢√¨√¢√¥√¢O',
        hair_front: '√©¬ø√Ö‚àû√πl',
        hair_back_accessory: '',
        head: '√≤√º√Ü‚ï©√©‚ïö√®œÑ1',
        face_back: '√Ö‚ïû√©Œ©(√Æ‚àö√®J√©¬Ω)',
        face_front: '√Ö‚ïû√©Œ©(√Æ‚àö√®J√©¬Ω)',
        eye: '√Ü‚ñê√©Œ¶√ª‚îå1',
        eye_color: '√Ü‚ñê√©Œ¶√ª‚îå1',
        accessory_back: '√©Œ±√©‚ñå√©√°√©‚ñë√ÜZ√©‚ñÄ(√∂¬ª)',
        accessory_front: '',
        accessory_middle_back: '√©Œ±√©‚ñå√©√°√©‚ñë√ÜZ√©‚ñÄ(√∂¬ª)',
        accessory_middle_front: '√©Œ±√©‚ñå√©√°√©‚ñë√ÜZ√©‚ñÄ(√∂¬ª)'
      },
      casual: {
        body_back: '√¢S√¢X√¢√¨√¢√®(√¢~√¢j)1',
        body_front: '√¢S√¢X√¢√¨√¢√®(√¢~√¢j)1',
        hair_back: '√¢V√¢√ß√º[√¢g',
        hair_front: '√¢C√¢√¥√¢e√º[√¢N',
        hair_back_accessory: '',
        head: '√â‚î¨√©‚î§√©‚ñÄ√©‚ïú√®œÑ2',
        face_back: '√¶f',
        face_front: '√¶f',
        eye: '√â√©√©Œ©√ª‚îå1',
        eye_color: '√â√©√©Œ©√ª‚îå1',
        accessory_back: '',
        accessory_front: '',
        accessory_middle_back: '',
        accessory_middle_front: ''
      }
    };

    const stickerTypes = ['heart', 'star', 'flower', 'skull', 'lightning', 'rainbow'];
    const stickerEmojis = {
      heart: 'üíñ',
      star: '‚≠ê',
      flower: 'üå∏',
      skull: 'üíÄ',
      lightning: '‚ö°',
      rainbow: 'üåà'
    };

    // Game state management
    let gameState = {
      body_back: '',
      body_front: '',
      body_front_color: '',
      hair_back: '',
      hair_front: '',
      hair_back_accessory: '',
      head: '',
      face_back: '',
      face_front: '',
      eye: '',
      eye_color: '',
      accessory_back: '',
      accessory_front: '',
      accessory_middle_back: '',
      accessory_middle_front: '',
      stickers: []
    };

    let history = [];
    let historyIndex = -1;
    let stickerCounter = 0;

    // Initialize
    function init() {
      saveState();
      showTab('body');
      updateUndoRedoButtons();
    }

    // Helper functions
    function getAssetPath(category, assetName) {
      if (!assetName) return '';
      return `default/${category}/${assetName}.png`;
    }

    function saveState() {
      // Remove future states if we're not at the end
      if (historyIndex < history.length - 1) {
        history = history.slice(0, historyIndex + 1);
      }
      
      history.push(JSON.parse(JSON.stringify(gameState)));
      
      // Limit history size
      if (history.length > 50) {
        history.shift();
      } else {
        historyIndex++;
      }
      
      updateUndoRedoButtons();
    }

    function updateUndoRedoButtons() {
      document.getElementById('undoBtn').disabled = historyIndex <= 0;
      document.getElementById('redoBtn').disabled = historyIndex >= history.length - 1;
    }

    function undo() {
      if (historyIndex > 0) {
        historyIndex--;
        gameState = JSON.parse(JSON.stringify(history[historyIndex]));
        updateCharacter();
        updateUndoRedoButtons();
        playClickSound();
      }
    }

    function redo() {
      if (historyIndex < history.length - 1) {
        historyIndex++;
        gameState = JSON.parse(JSON.stringify(history[historyIndex]));
        updateCharacter();
        updateUndoRedoButtons();
        playClickSound();
      }
    }

    function updateCharacter() {
      // Update all character layers
      Object.keys(gameState).forEach(key => {
        if (key !== 'stickers') {
          const element = document.getElementById(key);
          if (element) {
            element.src = gameState[key] ? getAssetPath(key, gameState[key]) : '';
          }
        }
      });
      
      // Update stickers
      updateStickers();
    }

    function updateStickers() {
      const container = document.getElementById('stickers-container');
      container.innerHTML = '';
      
      gameState.stickers.forEach(sticker => {
        const stickerElement = document.createElement('div');
        stickerElement.className = 'sticker';
        stickerElement.style.left = sticker.x + 'px';
        stickerElement.style.top = sticker.y + 'px';
        stickerElement.innerHTML = stickerEmojis[sticker.type] || '‚ùì';
        stickerElement.title = 'Double-click to remove';
        
        // Make draggable
        let isDragging = false;
        let startX, startY, initialX, initialY;
        
        stickerElement.addEventListener('mousedown', (e) => {
          isDragging = true;
          startX = e.clientX;
          startY = e.clientY;
          initialX = sticker.x;
          initialY = sticker.y;
          
          const handleMouseMove = (e) => {
            if (!isDragging) return;
            
            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;
            
            const newX = Math.max(0, Math.min(168, initialX + deltaX));
            const newY = Math.max(0, Math.min(268, initialY + deltaY));
            
            sticker.x = newX;
            sticker.y = newY;
            stickerElement.style.left = newX + 'px';
            stickerElement.style.top = newY + 'px';
          };
          
          const handleMouseUp = () => {
            isDragging = false;
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseUp);
          };
          
          document.addEventListener('mousemove', handleMouseMove);
          document.addEventListener('mouseup', handleMouseUp);
          e.preventDefault();
        });
        
        stickerElement.addEventListener('dblclick', () => {
          saveState();
          gameState.stickers = gameState.stickers.filter(s => s.id !== sticker.id);
          updateStickers();
          playClickSound();
        });
        
        container.appendChild(stickerElement);
      });
    }

    // Tab management
    function showTab(tabName) {
      // Update tab appearance
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      
      const container = document.getElementById('tab-content-container');
      
      if (tabName === 'body') {
        container.innerHTML = `
          <div class="tab-content open">
            <h3>Body & Outfits</h3>
            <h4>Head Shape</h4>
            <div class="option-grid">
              ${assetConfig.head.map(head => `
                <button class="option-button" onclick="setPart('head', '${head}')">
                  <img src="${getAssetPath('head', head)}" alt="${head}" />
                  <span>${head.slice(0, 8)}...</span>
                </button>
              `).join('')}
            </div>
            <h4>Body Front</h4>
            <div class="option-grid">
              ${assetConfig.body_front.slice(0, 6).map(body => `
                <button class="option-button" onclick="setPart('body_front', '${body}')">
                  <img src="${getAssetPath('body_front', body)}" alt="${body}" />
                  <span>${body.slice(0, 8)}...</span>
                </button>
              `).join('')}
            </div>
            <h4>Body Back</h4>
            <div class="option-grid">
              ${assetConfig.body_back.slice(0, 6).map(body => `
                <button class="option-button" onclick="setPart('body_back', '${body}')">
                  <img src="${getAssetPath('body_back', body)}" alt="${body}" />
                  <span>${body.slice(0, 8)}...</span>
                </button>
              `).join('')}
            </div>
          </div>
        `;
      } else if (tabName === 'hair') {
        container.innerHTML = `
          <div class="tab-content open">
            <h3>Hairstyles</h3>
            <h4>Front Hair</h4>
            <div class="option-grid">
              ${assetConfig.hair_front.map(hair => `
                <button class="option-button" onclick="setPart('hair_front', '${hair}')">
                  <img src="${getAssetPath('hair_front', hair)}" alt="${hair}" />
                  <span>${hair.slice(0, 8)}...</span>
                </button>
              `).join('')}
            </div>
            <h4>Back Hair</h4>
            <div class="option-grid">
              ${assetConfig.hair_back.slice(0, 6).map(hair => `
                <button class="option-button" onclick="setPart('hair_back', '${hair}')">
                  <img src="${getAssetPath('hair_back', hair)}" alt="${hair}" />
                  <span>${hair.slice(0, 8)}...</span>
                </button>
              `).join('')}
            </div>
          </div>
        `;
      } else if (tabName === 'face') {
        container.innerHTML = `
          <div class="tab-content open">
            <h3>Face Features</h3>
            <h4>Face Front</h4>
            <div class="option-grid">
              ${assetConfig.face_front.slice(0, 6).map(face => `
                <button class="option-button" onclick="setPart('face_front', '${face}')">
                  <img src="${getAssetPath('face_front', face)}" alt="${face}" />
                  <span>${face.slice(0, 8)}...</span>
                </button>
              `).join('')}
            </div>
            <h4>Face Back</h4>
            <div class="option-grid">
              ${assetConfig.face_back.slice(0, 6).map(face => `
                <button class="option-button" onclick="setPart('face_back', '${face}')">
                  <img src="${getAssetPath('face_back', face)}" alt="${face}" />
                  <span>${face.slice(0, 8)}...</span>
                </button>
              `).join('')}
            </div>
          </div>
        `;
      } else if (tabName === 'eyes') {
        container.innerHTML = `
          <div class="tab-content open">
            <h3>Eyes & Expression</h3>
            <h4>Eye Shape</h4>
            <div class="option-grid">
              ${assetConfig.eye.slice(0, 6).map(eye => `
                <button class="option-button" onclick="setPart('eye', '${eye}')">
                  <img src="${getAssetPath('eye', eye)}" alt="${eye}" />
                  <span>${eye.slice(0, 8)}...</span>
                </button>
              `).join('')}
            </div>
            <h4>Eye Color</h4>
            <div class="option-grid">
              ${assetConfig.eye_color.slice(0, 6).map(color => `
                <button class="option-button" onclick="setPart('eye_color', '${color}')">
                  <img src="${getAssetPath('eye_color', color)}" alt="${color}" />
                  <span>${color.slice(0, 8)}...</span>
                </button>
              `).join('')}
            </div>
          </div>
        `;
      } else if (tabName === 'accessories') {
        container.innerHTML = `
          <div class="tab-content open">
            <h3>Accessories</h3>
            <h4>Front Accessories</h4>
            <div class="option-grid">
              ${assetConfig.accessory_front.slice(0, 6).map(accessory => `
                <button class="option-button" onclick="setPart('accessory_front', '${accessory}')">
                  <img src="${getAssetPath('accessory_front', accessory)}" alt="${accessory}" />
                  <span>${accessory.slice(0, 8)}...</span>
                </button>
              `).join('')}
            </div>
            <h4>Hair Accessories</h4>
            <div class="option-grid">
              ${assetConfig.hair_back_accessory.map(accessory => `
                <button class="option-button" onclick="setPart('hair_back_accessory', '${accessory}')">
                  <img src="${getAssetPath('hair_back_accessory', accessory)}" alt="${accessory}" />
                  <span>${accessory.slice(0, 8)}...</span>
                </button>
              `).join('')}
            </div>
          </div>
        `;
      } else if (tabName === 'stickers') {
        container.innerHTML = `
          <div class="tab-content open">
            <h3>Drag & Drop Stickers</h3>
            <p>Click to add, then drag on character!</p>
            <div class="option-grid">
              ${stickerTypes.map(type => `
                <button class="option-button" onclick="addSticker('${type}')">
                  <span style="font-size: 24px;">${stickerEmojis[type]}</span>
                  <span>${type}</span>
                </button>
              `).join('')}
            </div>
            <button onclick="clearStickers()" style="width: 100%; margin-top: 10px;" class="control-buttons button">üßπ Clear All Stickers</button>
          </div>
        `;
      } else if (tabName === 'bundles') {
        container.innerHTML = `
          <div class="tab-content open">
            <h3>Style Bundles</h3>
            <p>Apply complete themed outfits!</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
              <button onclick="applyBundle('cute')" class="control-buttons button">
                üéÄ Cute Style<br><small>Sweet and adorable look</small>
              </button>
              <button onclick="applyBundle('elegant')" class="control-buttons button">
                ‚ú® Elegant Style<br><small>Sophisticated and classy</small>
              </button>
              <button onclick="applyBundle('casual')" class="control-buttons button">
                üëï Casual Style<br><small>Relaxed everyday look</small>
              </button>
            </div>
          </div>
        `;
      }
      
      playClickSound();
    }

    // Character customization functions
    function setPart(partId, value) {
      saveState();
      gameState[partId] = value;
      document.getElementById(partId).src = value ? getAssetPath(partId, value) : '';
      playClickSound();
    }

    function addSticker(type) {
      saveState();
      const newSticker = {
        type: type,
        x: Math.random() * 150,
        y: Math.random() * 150,
        id: 'sticker_' + (++stickerCounter)
      };
      gameState.stickers.push(newSticker);
      updateStickers();
      playClickSound();
    }

    function clearStickers() {
      saveState();
      gameState.stickers = [];
      updateStickers();
      playClickSound();
    }

    function randomizeCharacter() {
      saveState();
      
      // Randomize each part
      Object.keys(assetConfig).forEach(part => {
        const options = assetConfig[part];
        const randomOption = Math.random() < 0.8 ? options[Math.floor(Math.random() * options.length)] : '';
        gameState[part] = randomOption;
      });
      
      // Random stickers
      const stickerCount = Math.floor(Math.random() * 4);
      gameState.stickers = [];
      
      for (let i = 0; i < stickerCount; i++) {
        gameState.stickers.push({
          type: stickerTypes[Math.floor(Math.random() * stickerTypes.length)],
          x: Math.random() * 150,
          y: Math.random() * 150,
          id: 'sticker_' + (++stickerCounter)
        });
      }
      
      updateCharacter();
      playClickSound();
    }

    function resetCharacter() {
      saveState();
      Object.keys(gameState).forEach(key => {
        if (key !== 'stickers') {
          gameState[key] = '';
          const element = document.getElementById(key);
          if (element) element.src = '';
        }
      });
      gameState.stickers = [];
      updateStickers();
      playClickSound();
    }

    function applyBundle(bundleName) {
      const bundle = bundles[bundleName];
      if (!bundle) return;
      
      saveState();
      Object.keys(bundle).forEach(key => {
        gameState[key] = bundle[key];
      });
      updateCharacter();
      playClickSound();
    }

    function saveImage() {
      const target = document.getElementById('capture-area');
      if (typeof html2canvas !== 'undefined') {
        html2canvas(target).then(canvas => {
          const link = document.createElement('a');
          link.download = 'chloes-closet-character.png';
          link.href = canvas.toDataURL();
          link.click();
        });
      } else {
        alert('Screenshot feature requires html2canvas library to be loaded');
      }
      playClickSound();
    }

    function playClickSound() {
      // Simple click sound using Web Audio API
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'square';
        
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      } catch (error) {
        // Fallback: just log that sound was played
        console.log('üîä Click sound played');
      }
    }

    // Initialize the game when page loads
    window.addEventListener('load', init);
  </script>
</body>
</html>
